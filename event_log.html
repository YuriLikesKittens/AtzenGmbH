<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Event-Log · Einträge & Screenshots (Imgur Upload)</title>
  <style>
    :root{
      --bg:#0f172a; --text:#e5e7eb; --muted:#9ca3af; --border:#1f2937; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35);
      --accent:#7c3aed; --accent2:#06b6d4;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(160deg,#0b1020 0%,#0f172a 100%);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;padding:24px 16px 40px;}
    .wrap{max-width:1100px;margin:0 auto}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px}
    h1{margin:0;font-size:clamp(22px,4vw,32px);font-weight:800}
    a.btn{display:inline-block;padding:10px 14px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;text-decoration:none;font-weight:700;border:0}
    .grid{display:grid;gap:16px;grid-template-columns:1fr 1fr}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;backdrop-filter:blur(6px)}
    h2{margin:0 0 12px;font-size:18px}
    label{font-size:12px;text-transform:uppercase;letter-spacing:.06em;color:var(--muted)}
    input,select,button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#0b1020;color:var(--text);outline:none;transition:.2s}
    input:focus,select:focus{border-color:#4c1d95;box-shadow:0 0 0 4px rgba(124,58,237,.2)}
    .btn{cursor:pointer;font-weight:700;background:linear-gradient(135deg,var(--accent) 0%,var(--accent2) 100%);border:none;margin-top:8px;box-shadow:0 6px 16px rgba(6,182,212,.35)}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.05)}
    .muted{color:var(--muted);font-size:12px}
    .list{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media (max-width:900px){.list{grid-template-columns:1fr}}
    .item{display:grid;grid-template-columns:140px 1fr;gap:12px;border:1px solid var(--border);border-radius:14px;padding:12px;background:rgba(255,255,255,.03)}
    .thumb{width:140px;height:100px;background:#0a0f1f;border:1px solid var(--border);border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .thumb img{max-width:100%;max-height:100%;display:block}
    .meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px}
    .title{font-weight:700;margin:0 0 6px}
    .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    @media (max-width:700px){.row{grid-template-columns:1fr}}
    .hint{font-size:12px;color:#9ca3af;margin-top:6px}
    .status-ok{color:#86efac}
    .status-warn{color:#facc15}
    .status-err{color:#fca5a5}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>Event-Log · Einträge & Screenshots</h1>
      <a class="btn" href="public_sync_readonly_with_rates.html">Zur Übersicht</a>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Neues Event eintragen</h2>
        <div class="row">
          <div>
            <label>Art des Events</label>
            <select id="eventType">
              <option value="">— Bitte wählen —</option>
            </select>
          </div>
          <div>
            <label>Anzahl Mitglieder</label>
            <input type="number" id="memberCount" min="0" step="1" placeholder="z. B. 12" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Screenshot (optional)</label>
            <input type="file" id="screenshot" accept="image/*" />
            <div class="hint">Max. ~5 MB empfohlen. PNG/JPG/WebP. Upload via Imgur.</div>
          </div>
          <div>
            <label>Bemerkung (optional)</label>
            <input type="text" id="note" placeholder="z. B. Map/Server/MatchID" />
          </div>
        </div>
        <button class="btn" id="btnSubmit">Eintragen</button>
        <p class="muted" id="status"></p>
        <details style="margin-top:8px">
          <summary class="muted">Technische Details</summary>
          <pre id="debug" style="white-space:pre-wrap;color:#9ca3af;font-size:12px;background:#0b1020;border:1px solid #1f2937;border-radius:12px;padding:10px;max-height:160px;overflow:auto"></pre>
        </details>
      </div>

      <div class="card">
        <h2>Letzte Events</h2>
        <div id="list" class="list"></div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs (nur App + Firestore; KEIN Storage mehr nötig) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    // === Firebase-Konfiguration ===
    const firebaseConfig = {
      apiKey: "AIzaSyBgPA5LV1ILz5MmyzUezVumMgOuWoxfNxo",
      authDomain: "msauszahlung.firebaseapp.com",
      projectId: "msauszahlung",
      storageBucket: "msauszahlung.appspot.com",
      messagingSenderId: "1033439801595",
      appId: "1:1033439801595:web:4251badc1447ed8079805e",
      measurementId: "G-FWXF3GM505"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // === Imgur-Konfiguration ===
    // Hole dir hier einen Client-ID: https://api.imgur.com/oauth2/addclient (ohne OAuth, "Anonymous usage without user authorization")
    const IMGUR_CLIENT_ID = "REPLACE_WITH_YOUR_IMGUR_CLIENT_ID";

    // === Eventvorlagen (wie Auszahlungen) ===
    const eventTemplates = {
      "40er Kill": 25000, "50er Win": 35000, "Bizwar Kill Win": 20000, "Bizwar Kill Lose": 10000,
      "Bizwar Teilnahme": 10000, "Waffenfab. Kill Win": 20000, "Waffenfab. Kills Lose": 10000, "Waffenfab. Win": 20000,
      "Gießerei Kills Win": 20000, "Gießerei Kills Lose": 10000, "Bank": 50000, "Hafen Drop": 20000,
      "EKZ/Mall Win": 75000, "RP Fabrik Win": 300000, "RP Fabrik Teilnahme": 0, "Cayo": 100000,
      "Sanktion": 0, "Komplett Auszahlung": -1
    };

    // === UI Refs ===
    const eventType = document.getElementById('eventType');
    const memberCount = document.getElementById('memberCount');
    const screenshot = document.getElementById('screenshot');
    const note = document.getElementById('note');
    const btnSubmit = document.getElementById('btnSubmit');
    const status = document.getElementById('status');
    const debug = document.getElementById('debug');
    const list = document.getElementById('list');

    // Select füllen
    (function fillEventTypes(){
      const entries = Object.keys(eventTemplates).sort((a,b)=> a.localeCompare(b,"de"));
      for (const label of entries){
        const opt = document.createElement('option');
        opt.value = label;
        opt.textContent = label;
        eventType.appendChild(opt);
      }
    })();

    btnSubmit.onclick = submitEvent;

    async function submitEvent(){
      setStatus("Speichere…");
      setDebug("");
      try{
        const type = eventType.value.trim();
        const cnt = parseInt(memberCount.value || "0", 10);
        if (!type){ return fail("Bitte eine Event-Art wählen."); }
        if (isNaN(cnt) || cnt < 0){ return fail("Anzahl Mitglieder ungültig."); }

        // Optional: Screenshot -> Imgur
        let screenshotUrl = "";
        const file = screenshot.files && screenshot.files[0];
        if (file){
          if (!file.type.startsWith("image/")) { return fail("Nur Bilddateien erlaubt."); }
          if (file.size > 5 * 1024 * 1024) { return fail("Bild zu groß (max ~5 MB)."); }
          if (!IMGUR_CLIENT_ID || IMGUR_CLIENT_ID === "REPLACE_WITH_YOUR_IMGUR_CLIENT_ID"){
            warn("IMGUR_CLIENT_ID ist nicht gesetzt. Event wird ohne Bild gespeichert.");
          } else {
            try{
              screenshotUrl = await uploadToImgur(file);
            }catch(upErr){
              warn("Screenshot k
