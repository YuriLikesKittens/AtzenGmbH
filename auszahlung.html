<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üí∞ Auszahlungen </title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --blue: 0,150,255;
      --text:#f5faff;
      --muted:#b0c4de;
      --card-bg: rgba(6,16,26,.82);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      min-height:100%;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      overflow-x:hidden;
      background-image: radial-gradient(#021027, #000000);
    }

    /* Hintergrund-Bubbles */
    .container {
      position:fixed; inset:0;
      width:100%; height:100%;
      overflow:hidden;
      z-index:-2;
    }
    .circle-container {
      position:absolute;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }
    .circle {
      width:100%;
      height:100%;
      border-radius:50%;
      mix-blend-mode:screen;
      background-image: radial-gradient(
        hsl(180, 100%, 80%),
        hsl(180, 100%, 80%) 10%,
        hsla(180, 100%, 80%, 0) 56%
      );
      animation: fade-frames 2s infinite, scale-frames 6s infinite;
    }
    @keyframes fade-frames { 0%{opacity:1} 50%{opacity:0.6} 100%{opacity:1} }
    @keyframes scale-frames { 0%{transform:scale3d(0.4,0.4,1)} 50%{transform:scale3d(2,2,1)} 100%{transform:scale3d(0.4,0.4,1)} }

    /* Seite */
    .wrap{
      max-width:1400px;
      margin:0 auto;
      position:relative;
      z-index:1;
      padding:24px 16px 40px;
    }

    /* Header */
    .header {
      text-align:center;
      margin:10px 0 32px;
      opacity:0; transform:translateY(-14px);
      animation:fadeUp .8s ease forwards;
      animation-delay:.0s;
    }
    .header__title {
      font-family: Orbitron, sans-serif;
      font-size: clamp(28px, 6vw, 52px);
      color:#66cfff;
      text-shadow: 0 0 20px rgba(0,150,255,0.8),
                   0 0 40px rgba(0,150,255,0.6),
                   0 0 80px rgba(0,150,255,0.4);
      margin:0;
    }
    .header__subtitle {
      font-size:16px;
      color:#b0c4de;
      letter-spacing:2px;
      margin-top:8px;
    }
    .header::after {
      content:"";
      position:absolute;
      bottom:-14px;
      left:50%;
      transform:translateX(-50%);
      width:200px;
      height:4px;
      background:linear-gradient(90deg, transparent, #00aaff, transparent);
      box-shadow:0 0 20px rgba(0,150,255,0.7);
      border-radius:4px;
    }

    /* Buttons */
    .btnrow{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
      margin:32px 0 20px;
      opacity:0; transform:translateY(10px);
      animation:fadeUp .8s ease forwards;
      animation-delay:.35s;
    }
    a.btn, button.btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 14px;
      border-radius:12px;
      background:linear-gradient(135deg,#0096ff,#00e0ff);
      color:#fff; text-decoration:none; font-weight:700; border:0; cursor:pointer;
      transition: transform .2s ease, filter .2s ease, box-shadow .2s ease;
      box-shadow:0 10px 26px rgba(0,150,255,.3);
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.05);box-shadow:0 14px 36px rgba(0,150,255,.5)}

    @keyframes fadeUp { from {opacity:0; transform:translateY(16px)} to {opacity:1; transform:translateY(0)} }

    /* Cards */
    .card{
      position:relative;background:var(--card-bg);
      border-radius:20px;padding:20px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 14px 36px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
      backdrop-filter: blur(8px) saturate(1.2);
      margin-bottom:18px;
      overflow:hidden;
      text-align:left;

      opacity:0; transform:translateY(16px);
      animation:fadeUp .8s ease forwards;
    }
    .card.stagger-1{ animation-delay:.60s }
    .card.stagger-2{ animation-delay:.80s }
    .card.stagger-3{ animation-delay:1.00s }
    .card.stagger-4{ animation-delay:1.20s }

    .card::before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:radial-gradient(circle at var(--glow-x,50%) var(--glow-y,50%),
        rgba(var(--blue), calc(var(--glow-intensity,0)*.6)) 0%, transparent 60%);
      opacity:.85; transition:opacity .2s ease;
    }

    .chips{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0;justify-content:center}
    .chip{background:#0b1020;border:1px solid rgba(255,255,255,.16);border-radius:999px;padding:8px 12px;color:var(--muted);font-size:13px}

    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{
      position:sticky;top:0; z-index:1;
      background:rgba(10,15,31,.7);
      backdrop-filter: blur(6px);
      border-bottom:1px solid rgba(255,255,255,.16);
      text-transform:uppercase;font-size:12px;color:var(--muted);
      padding:10px;text-align:left
    }
    td{padding:10px;border-bottom:1px dashed #1f2a44}
    .right{text-align:right}
    .id{color:#a5b4fc;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

    .grid{display:grid;gap:16px;grid-template-columns:1fr 1fr}
    @media (max-width:1100px){.grid{grid-template-columns:1fr}}

    .warn{color:#fca5a5;font-size:12px;margin-top:6px}

    /* Spotlight */
    .spotlight{
      position:fixed;width:800px;height:800px;border-radius:50%;
      pointer-events:none; mix-blend-mode:screen; transform:translate(-50%,-50%);
      background:radial-gradient(circle,
        rgba(var(--blue),.15) 0%, rgba(var(--blue),.08) 15%, rgba(var(--blue),.04) 25%,
        rgba(var(--blue),.02) 40%, rgba(var(--blue),.01) 65%, transparent 70%);
      opacity:0; z-index:2;
    }

    /* Card Partikel */
    .particle{
      position:absolute;border-radius:50%;
      background:rgba(var(--blue),1);
      box-shadow:0 0 8px rgba(var(--blue),.6);
      pointer-events:none; z-index:0; opacity:.7;
      animation:floatParticle 4s ease-in-out infinite alternate;
    }
    @keyframes floatParticle{ from{transform:translateY(0) scale(1); opacity:.8} to{transform:translateY(-25px) scale(1.3); opacity:.3} }

    /* Footer RGB */
    footer{
      margin-top:24px;
      text-align:center;
      font-size:13px;
      font-weight:600;
      background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet, red);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-size:400% 400%;
      animation:rgbFlow 10s linear infinite;
    }
    @keyframes rgbFlow { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
  </style>
</head>
<body>
  <!-- Hintergrund -->
  <div class="container" id="bg-container"></div>
  <div class="spotlight" id="spotlight"></div>

  <div class="wrap">
    <!-- Header -->
    <div class="header">
      <h1 class="header__title">üí∞ Auszahlungen </h1>
      <p class="header__subtitle"> Fair ¬∑ min. 500k ¬∑ Echtzeit</p>
    </div>

    <!-- Buttons -->
    <div class="btnrow">
      <a class="btn" href="index.html">üè† Zur √úbersicht</a>
      <a class="btn" id="btnBackAdmin" href="admin_sync.html">‚öôÔ∏è Leaderschaft</a>
    </div>

    <!-- Cards -->
    <div class="card stagger-1">
      <div class="chips">
        <span class="chip">üë• Mitglieder: <b id="statMitglieder">0</b></span>
        <span class="chip">üí∂ Gesamtsaldo: <b id="statSaldo">0</b> $</span>
      </div>
      <div style="overflow:auto;max-height:38vh;border:1px solid rgba(255,255,255,.16);border-radius:12px">
        <table>
          <thead>
            <tr><th>Mitglied</th><th>ID</th><th class="right">Kontostand ($)</th></tr>
          </thead>
          <tbody id="tbodyMembers"></tbody>
        </table>
      </div>
      <div id="errMembers" class="warn" style="display:none"></div>
    </div>

    <div class="grid">
      <div class="card stagger-2">
        <h3>üì§ Letzte Auszahlungen</h3>
        <div style="overflow:auto;max-height:45vh;border:1px solid rgba(255,255,255,.16);border-radius:12px">
          <table>
            <thead>
              <tr><th>Datum</th><th>Mitglied</th><th>Event</th><th class="right">Betrag ($)</th><th class="right">Offene Auszahlung</th></tr>
            </thead>
            <tbody id="tbodyPayouts"></tbody>
          </table>
        </div>
        <div id="errPayouts" class="warn" style="display:none"></div>
      </div>

      <div class="card stagger-3">
        <h3>üì• Offene Auszahlung</h3>
        <div style="overflow:auto;max-height:45vh;border:1px solid rgba(255,255,255,.16);border-radius:12px">
          <table>
            <thead>
              <tr><th>Datum</th><th>Mitglied</th><th>Event</th><th class="right">Betrag ($)</th><th class="right">Offene Auszahlung</th></tr>
            </thead>
            <tbody id="tbodyDeposits"></tbody>
          </table>
        </div>
        <div id="errDeposits" class="warn" style="display:none"></div>
      </div>
    </div>

    <div class="card stagger-4">
      <h3>üìë Auszahlungs-Liste</h3>
      <div style="overflow:auto;max-height:50vh;border:1px solid rgba(255,255,255,.16);border-radius:12px">
        <table>
          <thead><tr><th>Event</th><th class="right">Betrag ($)</th></tr></thead>
          <tbody id="tbodyRates"></tbody>
        </table>
      </div>
      <p class="chip">‚ÑπÔ∏è Hinweis: <b>Komplett Auszahlung</b> = gesamter Kontostand ¬∑ <b>Sanktion</b> = individuell</p>
    </div>

    <footer>Made by Alvaro SolanoHebel | 20367</footer>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js" defer></script>

  <!-- Firebase Code -->
  <script>
  window.addEventListener('load', () => {
    if (!window.firebase) return;

    const firebaseConfig = {
      apiKey: "AIzaSyBgPA5LV1ILz5MmyzUezVumMgOuWoxfNxo",
      authDomain: "msauszahlung.firebaseapp.com",
      projectId: "msauszahlung",
      storageBucket: "msauszahlung.appspot.com",
      messagingSenderId: "1033439801595",
      appId: "1:1033439801595:web:4251badc1447ed8079805e",
      measurementId: "G-FWXF3GM505"
    };
    try { firebase.initializeApp(firebaseConfig); } catch (e) { if(!/already exists/i.test(String(e))) throw e; }
    const auth = firebase.auth();
    const db   = firebase.firestore();

    const tbodyMembers  = document.getElementById('tbodyMembers');
    const tbodyPayouts  = document.getElementById('tbodyPayouts');
    const tbodyDeposits = document.getElementById('tbodyDeposits');
    const tbodyRates    = document.getElementById('tbodyRates');
    const statMitglieder= document.getElementById('statMitglieder');
    const statSaldo     = document.getElementById('statSaldo');
    const errMembers    = document.getElementById('errMembers');
    const errPayouts    = document.getElementById('errPayouts');
    const errDeposits   = document.getElementById('errDeposits');

    const eventTemplates = {
      "40er Kill / Win": 30000,
      "40er Kill / Lose": 15000,
      "50er Win": 35000,
      "Bizwar Kill Win": 20000,
      "Bizwar Kill Lose": 10000,
      "Bizwar Teilnahme": 10000,
      "Waffenfab. Kill Win": 20000,
      "Waffenfab. Kills Lose": 10000,
      "Waffenfab. Win": 20000,
      "Gie√üerei Kills Win": 20000,
      "Gie√üerei Kills Lose": 10000,
      "Bank (Gewinn Abh√§ngig)": 20000,
      "Hafen Drop": 25000,
      "EKZ/Mall Win": 50000,
      "RP Fabrik Win": 300000,
      "RP Fabrik Teilnahme": 0,
      "Cayo": 50000,
      "Sanktion": 0,
      "Komplett Auszahlung": -1
    };

    // Mitglieder live
    db.collection('members').orderBy('balance','desc')
      .onSnapshot(snap=>{
        tbodyMembers.innerHTML = '';
        let total = 0, count = 0;
        snap.forEach(doc=>{
          const m = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${escapeHTML(m.name)}</td>
                          <td class="id">${escapeHTML(m.id||'')}</td>
                          <td class="right">${toLocale(m.balance||0)}</td>`;
          tbodyMembers.appendChild(tr);
          total += (m.balance||0); count++;
        });
        statMitglieder.textContent = count;
        statSaldo.textContent = toLocale(round2(total));
      },err=>{
        errMembers.textContent = "Fehler: " + err.message; errMembers.style.display='';
      });

    // Transaktionen live
    db.collection('transactions').orderBy('ts','desc').limit(100)
      .onSnapshot(snap=>{
        tbodyPayouts.innerHTML=''; tbodyDeposits.innerHTML='';
        snap.forEach(doc=>{
          const t = doc.data();
          const row = `<td>${formatDate(t.ts)}</td>
                       <td>${escapeHTML(t.member||'')}</td>
                       <td>${escapeHTML(t.event||'')}</td>
                       <td class="right">${toLocale(round2(t.amount||0))}</td>
                       <td class="right">${toLocale(round2(t.newBalance||0))}</td>`;
          const tr = document.createElement('tr'); tr.innerHTML=row;
          if(t.type==='auszahlung') tbodyPayouts.appendChild(tr);
          else if(t.type==='einzahlung') tbodyDeposits.appendChild(tr);
        });
      },err=>{
        errPayouts.textContent="Fehler: "+err.message; errPayouts.style.display='';
        errDeposits.textContent="Fehler: "+err.message; errDeposits.style.display='';
      });

    // Auszahlungstabelle
    tbodyRates.innerHTML = Object.entries(eventTemplates)
      .sort((a,b)=>a[0].localeCompare(b[0],'de'))
      .map(([label,val])=>{
        let txt = val===-1 ? "Gesamter Kontostand" :
                  val===0 ? "Individuell" : toLocale(val);
        return `<tr><td>${escapeHTML(label)}</td><td class="right">${txt}</td></tr>`;
      }).join("");

    // Helpers
    function round2(n){return Math.round((n+Number.EPSILON)*100)/100}
    function toLocale(n){return (n||0).toLocaleString('de-DE')}
    function formatDate(ts){try{return new Date(ts).toLocaleString('de-DE')}catch(e){return ts}}
    function escapeHTML(str){return String(str).replace(/[&<>'"]/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','\'':'&#39;','"':'&quot;'}[s]))}
  });
  </script>

  <script>
    // Hintergrund-Bubbles (jetzt von OBEN nach UNTEN, auch √ºber Header sichtbar)
    const container = document.getElementById('bg-container');
    const numCircles = 100;
    for (let i=0; i<numCircles; i++) {
      const circleContainer = document.createElement('div');
      circleContainer.className = 'circle-container';
      const circle = document.createElement('div');
      circle.className = 'circle';
      circleContainer.appendChild(circle);

      const size = Math.random()*8+4;
      circleContainer.style.width = size+'px';
      circleContainer.style.height = size+'px';
      circleContainer.style.left = Math.random()*100+'vw';
      circleContainer.style.top = '-50px'; // Start oben, sichtbar √ºber Header

      const moveDuration = 7000 + Math.random()*5000;
      const startY = -30 - Math.random()*20;
      const endY = 120 + Math.random()*20;
      const animName = `move-${i}`;

      const keyframes = `
        @keyframes ${animName} {
          from { transform: translate3d(${Math.random()*100}vw, ${startY}vh, 0); }
          to   { transform: translate3d(${Math.random()*100}vw, ${endY}vh, 0); }
        }
      `;
      const style = document.createElement('style');
      style.innerHTML = keyframes;
      document.head.appendChild(style);

      circleContainer.style.animationName = animName;
      circleContainer.style.animationDuration = moveDuration+'ms';
      circleContainer.style.animationDelay = '0ms';
      container.appendChild(circleContainer);
    }

    // Spotlight + Card Partikel
    const spotlight = document.getElementById('spotlight');
    const cards = document.querySelectorAll('.card');
    document.addEventListener('mousemove', e => {
      spotlight.style.left = e.clientX + 'px';
      spotlight.style.top = e.clientY + 'px';
      spotlight.style.opacity = 1;
      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        card.style.setProperty('--glow-x', x + '%');
        card.style.setProperty('--glow-y', y + '%');
        card.style.setProperty('--glow-intensity', '1');
      });
    });
    cards.forEach(card => {
      for (let i=0; i<20; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = 3 + Math.random()*6;
        p.style.width = size+'px';
        p.style.height = size+'px';
        p.style.left = Math.random()*(card.offsetWidth-size)+'px';
        p.style.top = Math.random()*(card.offsetHeight-size)+'px';
        p.style.animationDuration = (3+Math.random()*4)+'s';
        p.style.animationDelay = (Math.random()*4)+'s';
        card.appendChild(p);
      }
    });
  </script>
</body>
</html>
